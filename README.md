## gachiFighterBot

### Описание
Телеграм бот, который умеет выбирать пидора дня, ведет статистику, а также способен организовывать поединки. 

### Фичи
- /start - Выбрать пидора дня
- /register - Зарегистрироваться
- /rating - Рейтинг пидорасов
- /duel, /accept - Вызов на бой / принять бой
- /fight_stats - Статистика боев

### Техническое описание
- Бот состоит из основного файла main.py, которые содержит асинхронные функции, отвечающие за различный функционал
- Для реализации фичей используется база данных postgresql для хранения пользователей, истории, статистики и т.д. 
- Файл ddl.sql содержит все create table стейтменты, необходимые для запуска. 

### Для разработчиков
## Инструкция по работе с миграциями:
1) Вносить изменения нужно поэтапно (ни в коем случае не править старые миграции)
2) Миграции лежат в папке migrations
3) Там создаем папку, к примеру, r2 (предыдущая , к примеру, была r1). Далее создаем конкретную миграцию (еще одну папку), кладем туда sql файл с изменениями + создаем (в r2) changelog.xml по примеру предыдущих миграций.
4) В корневой папке migrations вносим изменения еще в один changelog.xml (верхнеуровневый)
5) Готово. 

## Инструкция как вносить изменения в код:
1) Устанавливаем docker локально
2) Клонируем репозиторий
3) Создаем .env файл по аналогии с .env.template
4) Запускаем dev окружение в контейнерах (dev база для тестов), чтобы туда можно было достучаться
5) Для запуска используем yaml конфиг docker-compose.dev.yaml и команду:
```sh
docker compose -f docker-compose.dev.yaml up --build --force-recreate
```
6) Вносим необходимые изменения в коде, тестируем с помощью бота test-gachi-fighter-bot
7) Если все ок, не было ошибок, миграции прошли. Делаем MR.
8) Отправляем на ревью
9) Готово.

## Инструкции по прокидыванию портов для разработки бота на вебхуках
1) В отдельном терминале запускаем команду:
```sh
ssh -R 8083:localhost:8083 user@remote_host
```
2) Запускаем бота на порту 8083
3) Проверяем что запросы доходят до бота
4) Готово.
